import{d as I,r as H,s as $,f as b,w,o as A,b as x,c as u,p as h}from"./index-C87eDAxg.js";import{h as y,t as O,P as L,v as S}from"./index-DNvEjbjy.js";const N={tocItem:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:()=>{}},scrollElement:{type:[String,Object],default:""},onClick:{type:Function,default:()=>{}},scrollElementOffsetTop:{type:Number,default:0}},C=I({props:N,setup(l){return()=>{const{tocItem:n,mdHeadingId:d,scrollElement:o,onClick:m,scrollElementOffsetTop:E}=l;return u("div",{class:[`${h}-catalog-link`,n.active&&`${h}-catalog-active`],onClick:s=>{m(s,n),s.stopPropagation();const p=d(n.text,n.level,n.index),i=document.getElementById(p),e=o instanceof Element?o:document.querySelector(o);if(i&&e){let t=i.offsetParent,c=i.offsetTop;if(e.contains(t))for(;t&&e!=t;)c+=t==null?void 0:t.offsetTop,t=t==null?void 0:t.offsetParent;e==null||e.scrollTo({top:c-E,behavior:"smooth"})}}},[u("span",{title:n.text},[n.text]),u("div",{class:`${h}-catalog-wrapper`},[n.children&&n.children.map(s=>u(C,{mdHeadingId:d,key:`${n.text}-link-${s.level}-${s.text}`,tocItem:s,scrollElement:o,onClick:m,scrollElementOffsetTop:E},null))])])}}}),M=C,F={editorId:{type:String},class:{type:String,default:""},mdHeadingId:{type:Function,default:l=>l},scrollElement:{type:[String,Object]},theme:{type:String,default:"light"},offsetTop:{type:Number,default:20},scrollElementOffsetTop:{type:Number,default:0},onClick:{type:Function},onActive:{type:Function}},k=I({name:"MdCatalog",props:F,emits:["onClick","onActive"],setup(l,n){const d=l.editorId,o=H({list:[],show:!1,scrollElement:l.scrollElement||`#${d}-preview-wrapper`}),m=$(),E=b(()=>{const e=[];return o.list.forEach((t,c)=>{const{text:v,level:T}=t,a={level:T,text:v,index:c+1,active:m.value===t};if(e.length===0)e.push(a);else{let r=e[e.length-1];if(a.level>r.level)for(let f=r.level+1;f<=6;f++){const{children:g}=r;if(!g){r.children=[a];break}if(r=g[g.length-1],a.level<=r.level){g.push(a);break}}else e.push(a)}}),e}),s=()=>o.scrollElement instanceof HTMLElement?o.scrollElement:document.querySelector(o.scrollElement),p=e=>{if(e.length===0)return o.list=[],!1;const{activeHead:t}=e.reduce((c,v,T)=>{const a=document.getElementById(l.mdHeadingId(v.text,v.level,T+1));if(a instanceof HTMLElement){const r=s(),f=S(a,r);if(f<l.offsetTop&&f>c.minTop)return{activeHead:v,minTop:f}}return c},{activeHead:e[0],minTop:Number.MIN_SAFE_INTEGER});m.value=t,o.list=e},i=()=>{p(o.list)};return w(()=>m.value,e=>{const t=e?{...e}:void 0;l.onActive?l.onActive(t):n.emit("onActive",t)}),A(()=>{const e=s(),t=e===document.documentElement?window:e;t==null||t.addEventListener("scroll",i),y.on(d,{name:O,callback:c=>{t==null||t.removeEventListener("scroll",i),p(c),t==null||t.addEventListener("scroll",i)}}),y.emit(d,L)}),x(()=>{var e;const t=s();(e=t===document.documentElement?window:t)==null||e.removeEventListener("scroll",i)}),()=>u("div",{class:`${h}-catalog${l.theme==="dark"?"-dark":""} ${l.class}`},[E.value.map(e=>u(M,{mdHeadingId:l.mdHeadingId,tocItem:e,key:`link-${e.level}-${e.text}`,scrollElement:o.scrollElement,onClick:(t,c)=>{l.onClick?l.onClick(t,c):n.emit("onClick",t,c)},scrollElementOffsetTop:l.scrollElementOffsetTop},null))])}});k.install=l=>(l.component(k.name,k),l);export{k as M};
