import{d as y,r as H,s as w,f as $,w as b,o as A,b as x,c as u,p as T}from"./index-DfvXbvEB.js";import{i as C,v as O,P as S,w as L}from"./index-CUWU1ZCm.js";const N={tocItem:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:()=>{}},scrollElement:{type:[String,Object],default:""},onClick:{type:Function,default:()=>{}},scrollElementOffsetTop:{type:Number,default:0}},I=y({props:N,setup(l){return()=>{const{tocItem:o,mdHeadingId:d,scrollElement:c,onClick:m,scrollElementOffsetTop:E}=l;return u("div",{class:[`${T}-catalog-link`,o.active&&`${T}-catalog-active`],onClick:s=>{m(s,o),s.stopPropagation();const p=d(o.text,o.level,o.index),a=document.getElementById(p),e=c instanceof Element?c:document.querySelector(c);if(a&&e){let t=a.offsetParent,n=a.offsetTop;if(e.contains(t))for(;t&&e!=t;)n+=t==null?void 0:t.offsetTop,t=t==null?void 0:t.offsetParent;e==null||e.scrollTo({top:n-E,behavior:"smooth"})}}},[u("span",{title:o.text},[o.text]),u("div",{class:`${T}-catalog-wrapper`},[o.children&&o.children.map(s=>u(I,{mdHeadingId:d,key:`${o.text}-link-${s.level}-${s.text}`,tocItem:s,scrollElement:c,onClick:m,scrollElementOffsetTop:E},null))])])}}}),M=I,F={editorId:{type:String},class:{type:String,default:""},mdHeadingId:{type:Function,default:l=>l},scrollElement:{type:[String,Object]},theme:{type:String,default:"light"},offsetTop:{type:Number,default:20},scrollElementOffsetTop:{type:Number,default:0},onClick:{type:Function},onActive:{type:Function}},k=y({name:"MdCatalog",props:F,emits:["onClick","onActive"],setup(l,o){const d=l.editorId,c=H({list:[],show:!1,scrollElement:l.scrollElement||`#${d}-preview-wrapper`}),m=w(),E=$(()=>{const e=[];return c.list.forEach((t,n)=>{const{text:v,level:h}=t,i={level:h,text:v,index:n+1,active:m.value===t};if(e.length===0)e.push(i);else{let r=e[e.length-1];if(i.level>r.level)for(let f=r.level+1;f<=6;f++){const{children:g}=r;if(!g){r.children=[i];break}if(r=g[g.length-1],i.level<=r.level){g.push(i);break}}else e.push(i)}}),e}),s=()=>c.scrollElement instanceof HTMLElement?c.scrollElement:document.querySelector(c.scrollElement),p=e=>{if(e.length===0)return c.list=[],!1;const{activeHead:t}=e.reduce((n,v,h)=>{const i=document.getElementById(l.mdHeadingId(v.text,v.level,h+1));if(i instanceof HTMLElement){const r=s(),f=L(i,r);if(f<l.offsetTop&&f>n.minTop)return{activeHead:v,minTop:f}}return n},{activeHead:e[0],minTop:Number.MIN_SAFE_INTEGER});m.value=t,c.list=e},a=()=>{p(c.list)};return b(()=>m.value,e=>{const t=e?{...e}:void 0;l.onActive?l.onActive(t):o.emit("onActive",t)}),A(()=>{let e=window;const t=()=>{const n=s();e=n===document.documentElement?window:n};C.on(d,{name:O,callback:n=>{e==null||e.removeEventListener("scroll",a),p(n),t(),e==null||e.addEventListener("scroll",a)}}),C.emit(d,S),t(),e==null||e.addEventListener("scroll",a)}),x(()=>{var e;const t=s();(e=t===document.documentElement?window:t)==null||e.removeEventListener("scroll",a)}),()=>u("div",{class:`${T}-catalog${l.theme==="dark"?"-dark":""} ${l.class}`},[E.value.map(e=>u(M,{mdHeadingId:l.mdHeadingId,tocItem:e,key:`link-${e.level}-${e.text}`,scrollElement:c.scrollElement,onClick:(t,n)=>{l.onClick?l.onClick(t,n):o.emit("onClick",t,n)},scrollElementOffsetTop:l.scrollElementOffsetTop},null))])}});k.install=l=>(l.component(k.name,k),l);export{k as M};
