import{d as T,r as C,s as x,g as H,w as b,o as w,e as O,c as f,a as h}from"./index-CzXvZsH1.js";import{a as I,m as N,D as S,U as F}from"./index-DeQSHfWl.js";const A={tocItem:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:()=>{}},scrollElement:{type:[String,Object],default:""},onClick:{type:Function,default:()=>{}},scrollElementOffsetTop:{type:Number,default:0}},$=T({props:A,setup(l){return()=>{const{tocItem:n,mdHeadingId:d,scrollElement:o,onClick:m,scrollElementOffsetTop:v}=l;return f("div",{class:[`${h}-catalog-link`,n.active&&`${h}-catalog-active`],onClick:i=>{m(i,n),i.stopPropagation();const E=d(n.text,n.level,n.index),r=document.getElementById(E),e=o instanceof Element?o:document.querySelector(o);if(r&&e){let t=r.offsetParent,c=r.offsetTop;if(e.contains(t))for(;t&&e!=t;)c+=t==null?void 0:t.offsetTop,t=t==null?void 0:t.offsetParent;e==null||e.scrollTo({top:c-v,behavior:"smooth"})}}},[f("span",{title:n.text},[n.text]),f("div",{class:`${h}-catalog-wrapper`},[n.children&&n.children.map(i=>f($,{mdHeadingId:d,key:`${n.text}-link-${i.level}-${i.text}`,tocItem:i,scrollElement:o,onClick:m,scrollElementOffsetTop:v},null))])])}}}),L=$,M={editorId:{type:String},class:{type:String,default:""},mdHeadingId:{type:Function,default:l=>l},scrollElement:{type:[String,Object]},theme:{type:String,default:"light"},offsetTop:{type:Number,default:20},scrollElementOffsetTop:{type:Number,default:0},onClick:{type:Function},onActive:{type:Function}},y=T({name:"MdCatalog",props:M,emits:["onClick","onActive"],setup(l,n){const d=l.editorId,o=C({list:[],show:!1,scrollElement:l.scrollElement||`#${d}-preview-wrapper`}),m=x(),v=H(()=>{const e=[];return o.list.forEach((t,c)=>{const{text:p,level:k}=t,s={level:k,text:p,index:c+1,active:m.value===t};if(e.length===0)e.push(s);else{let a=e[e.length-1];if(s.level>a.level)for(let u=a.level+1;u<=6;u++){const{children:g}=a;if(!g){a.children=[s];break}if(a=g[g.length-1],s.level<=a.level){g.push(s);break}}else e.push(s)}}),e}),i=()=>o.scrollElement instanceof HTMLElement?o.scrollElement:document.querySelector(o.scrollElement),E=e=>{if(e.length===0)return o.list=[],!1;const{activeHead:t}=e.reduce((c,p,k)=>{const s=document.getElementById(l.mdHeadingId(p.text,p.level,k+1));if(s instanceof HTMLElement){const a=i(),u=F(s,a);if(u<l.offsetTop&&u>c.minTop)return{activeHead:p,minTop:u}}return c},{activeHead:e[0],minTop:Number.MIN_SAFE_INTEGER});m.value=t,o.list=e},r=()=>{E(o.list)};return b(()=>m.value,e=>{const t=e?{...e}:void 0;l.onActive?l.onActive(t):n.emit("onActive",t)}),w(()=>{const e=i(),t=e===document.documentElement?window:e;t==null||t.addEventListener("scroll",r),I.on(d,{name:N,callback:c=>{t==null||t.removeEventListener("scroll",r),E(c),t==null||t.addEventListener("scroll",r)}}),I.emit(d,S)}),O(()=>{var e;const t=i();(e=t===document.documentElement?window:t)==null||e.removeEventListener("scroll",r)}),()=>f("div",{class:`${h}-catalog${l.theme==="dark"?"-dark":""} ${l.class}`},[v.value.map(e=>f(L,{mdHeadingId:l.mdHeadingId,tocItem:e,key:`link-${e.level}-${e.text}`,scrollElement:o.scrollElement,onClick:(t,c)=>{l.onClick?l.onClick(t,c):n.emit("onClick",t,c)},scrollElementOffsetTop:l.scrollElementOffsetTop},null))])}});y.install=l=>(l.component(y.name,y),l);export{y as k};
